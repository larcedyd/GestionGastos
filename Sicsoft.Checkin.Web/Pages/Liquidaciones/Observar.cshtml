@page "{id}"
@model InversionGloblalWeb.Pages.Liquidaciones.ObservarModel
@{
    ViewData["Title"] = "Liquidación";
}
@section Title{
    <h2><i></i> @ViewData["Title"]</h2>
}
@using System.Globalization;
@section breadcrumb{
    <li class="breadcrumb-item">
        <a asp-page="./Index">Liquidaciones</a>
    </li>

    <li class="breadcrumb-item active">
        <strong>Observar </strong>
    </li>
}
@{
    NumberFormatInfo formato = new CultureInfo("en-US").NumberFormat;
    formato.CurrencyGroupSeparator = ",";
    formato.NumberDecimalSeparator = ".";


}
@section TitleAction{
    <a asp-page="./Index" class="nav-link text-dark"><i class="fa fa-arrow-circle-o-left "></i>  Regresar</a>
}
@section styles{
    <link rel="stylesheet" href="~/lib/summernote/summernote-bs4.css" />
    <link rel="stylesheet" href="~/lib/select2/css/select2.min.css" />
    <link rel="stylesheet" href="~/lib/select2/css/select2-bootstrap4.min.css" />
    <link href="~/lib/dropzone/basic.css" rel="stylesheet" />
    <link href="~/lib/dropzone/dropzone.css" rel="stylesheet" />
    <link href="~/lib/iCheck/skins/square/green.css" rel="stylesheet" />
    <link href="~/lib/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/4.0.0/css/jasny-bootstrap.min.css">
    <style>
        .tableFixHead th {
            position: sticky;
            top: 0;
            background: white;
        }
    </style>

}
@section scripts{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/lib/summernote/summernote-bs4.min.js"></script>
    <script src="~/lib/select2/js/select2.min.js"></script>
    <script src="~/lib/dropzone/dropzone.js"></script>
    <script src="~/lib/iCheck/icheck.js"></script>
    <script>
         function Aceptar() {
            Swal.fire({
                title: '¿Desea aceptar esta liquidación?',
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: `Aceptar`,
                denyButtonText: `Cancelar`,
                customClass: {
                    confirmButton: 'swalBtnColor',
                    denyButton: 'swalDeny'
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: 'GET',

                        url: '@Url.Page("Observar", "Aceptar")',
                        dataType: 'text',
                        data: { idB: $("#idCierre").text(), comentario: $("#Comentario").val() },
                        headers: {
                            RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                        },
                        success: function (json) {

                            $("#divProcesando").hide();

                            if ($('.modal-backdrop').is(':visible')) {

                                $('body').removeClass('modal-open');
                                $('.modal-backdrop').hide();
                            }
                            console.log("resultado " + json);
                            if (json == "true") {
                                Swal.fire({
                                    title: "Ha sido aceptado con éxito",

                                    icon: 'success',
                                    showCancelButton: false,

                                    confirmButtonText: 'OK',
                                    customClass: {
                                        confirmButton: 'swalBtnColor',

                                    },
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        window.location.href = window.location.href.split("/Observar")[0];
                                    }
                                })

                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Ha ocurrido un error al intentar aceptar'

                                })
                            }
                        },

                        beforeSend: function (xhr) {

                            $("#divProcesando").modal("show");
                        },
                        complete: function () {

                        },
                        error: function (error) {

                        }
                    });
                }
            })

        }

        function Rechazar() {
            Swal.fire({
                title: '¿Desea rechazar esta liquidación?',
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: `Aceptar`,
                denyButtonText: `Cancelar`,
                customClass: {
                    confirmButton: 'swalBtnColor',
                    denyButton: 'swalDeny'
                },
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: 'GET',

                        url: '@Url.Page("Observar", "Rechazar")',
                        dataType: 'text',
                        data: { idB: $("#idCierre").text(), comentario: $("#Comentario").val() },
                        headers: {
                            RequestVerificationToken: $('input:hidden[name="__RequestVerificationToken"]').val()
                        },
                        success: function (json) {

                            $("#divProcesando").hide();

                            if ($('.modal-backdrop').is(':visible')) {

                                $('body').removeClass('modal-open');
                                $('.modal-backdrop').hide();
                            }
                            console.log("resultado " + json);
                            if (json == "true") {
                                Swal.fire({
                                    title: "Ha sido rechazado con éxito",

                                    icon: 'success',
                                    showCancelButton: false,

                                    confirmButtonText: 'OK',
                                    customClass: {
                                        confirmButton: 'swalBtnColor',

                                    },
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        window.location.href = window.location.href.split("/Observar")[0];
                                    }
                                })

                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Ha ocurrido un error al intentar aceptar'

                                })
                            }
                        },

                        beforeSend: function (xhr) {

                            $("#divProcesando").modal("show");
                        },
                        complete: function () {

                        },
                        error: function (error) {

                        }
                    });
                }
            })

        }
    </script>

}

<div class="row" style="text-align: center;">
    <div class="col-sm-1"></div>
    <div class="col-sm-10">
        <div class="ibox ">

            <div class="ibox-content">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-group row">
                            <div class="col-sm-6">
                                <label class="col-form-label">ID.:</label>
                            </div>
                            <div class="col-sm-4">
                                <label id="idCierre" style="line-height: 32px;">
                                    @Model.Liquidacion.EncCierre.idCierre
                                </label>

                            </div>
                        </div>







                    </div>

                    <div class="col-sm-6">


                        <div class="form-group row">
                            <div class="col-sm-5">
                                <label class="col-form-label">Periodo:</label>
                            </div>
                            <div class="col-sm-6" style="text-align: left;">
                                <label id="PrecioVenta" style="line-height: 32px;">
                                    @Model.Liquidacion.EncCierre.Periodo
                                </label>

                            </div>
                        </div>




                    </div>
                    <div class="col-sm-3">




                        <div class="form-group row">
                            <div class="col-sm-3">
                                <label class="col-form-label">Fecha:</label>
                            </div>
                            <div class="col-sm-5">
                                <label id="PrecioVenta" style="line-height: 32px;">
                                    @Model.Liquidacion.EncCierre.FechaCierre.Value.ToString("dd/MM/yyyy")
                                </label>

                            </div>
                        </div>


                    </div>
                   
                </div>

            </div>
        </div>


    </div>
    <div class="col-sm-1"></div>

</div>

<div class="row">
    <div class="col-sm-12">
        <div class="ibox">

            <div class="ibox-content lista">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="table-responsive tableFixHead" style="padding:inherit; overflow-y:scroll;    z-index: 5; height: 275px;">
                            <table class="table table-striped">
                                <thead>
                                    <tr>

                                        <th align="center" style=" text-align: center;"><h3>Cons. Hacienda</h3></th>

                                        <th align="center" style=" text-align: center;"><h3>Fecha</h3></th>
                                        <th align="center" style=" text-align: center;"><h3>Proveedor</h3></th>
                                        <th align="center" style=" text-align: center;"><h3>Total</h3></th>


                                    </tr>

                                </thead>
                                <tbody id="tbody">
                                    @foreach (var item in Model.Objeto)
                                    {
                                        <tr>

                                            <td align="center" style="padding-top:15px;">  <p style="font-size:15px;">@item.ConsecutivoHacienda </p></td>

                                            <td align="center" style="padding-top:15px;">  <p style="font-size:15px;">@item.FecFactura.Value.ToString("dd/MM/yyyy") </p></td>
                                            <td align="center" style="padding-top:15px;">
                                                <p style="font-size:15px;">
                                                    @item.NomProveedor


                                                </p>
                                            </td>
                                            <td align="right" style="padding-top:13px;"> <p style="font-size:15px;">@decimal.Round(item.TotalComprobante.Value, 2).ToString("N", formato) </p></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>

                        </div>
                    </div>


                </div>
                <hr />
                <div class="row">
                    <div class="col-sm-9">
                        <div class="row">

                            <div class="col-sm-12">
                                <label class="col-form-label">Observación:</label>
                            </div>
                            <div class="col-sm-8">
                                @if (Model.Liquidacion.EncCierre.Estado == "E")
                                {

                                    <textarea rows="5" class="form-control" id="Comentario" asp-for="Liquidacion.EncCierre.Observacion"></textarea>
                                }
                                else
                                {
                                    <textarea rows="5" class="form-control" id="Comentario" asp-for="Liquidacion.EncCierre.Observacion" readonly></textarea>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3" style="text-align: right;">
                        <div class="row">

                            <div class="col-sm-12">

                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table; font-weight: 500 !important; font-style: normal;">SubTotal:</label>

                                            </td>
                                            <td>
                                                <label id="subtotal" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.SubTotal.Value,2)</label>
                                            </td>

                                        </tr>
                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> Descuento:</label>

                                            </td>
                                            <td>
                                                <label id="descuento" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Descuento.Value, 2)</label>
                                            </td>
                                        </tr>
                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> Impuesto:</label>

                                            </td>
                                            <td>
                                                <label id="impuesto" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Impuestos.Value, 2)</label>
                                            </td>
                                        </tr>
                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> I.V.A 1:</label>

                                            </td>
                                            <td>
                                                <label id="impuesto1" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Impuesto1, 2)</label>
                                            </td>
                                        </tr>

                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> I.V.A 2:</label>

                                            </td>
                                            <td>
                                                <label id="impuesto2" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Impuesto2, 2)</label>
                                            </td>
                                        </tr>

                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> I.V.A 4:</label>

                                            </td>
                                            <td>
                                                <label id="impuesto4" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Impuesto4, 2)</label>
                                            </td>
                                        </tr>

                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> I.V.A 8:</label>

                                            </td>
                                            <td>
                                                <label id="impuesto8" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Impuesto8, 2)</label>
                                            </td>
                                        </tr>

                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> I.V.A 13:</label>

                                            </td>
                                            <td>
                                                <label id="impuesto13" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Impuesto13, 2)</label>
                                            </td>
                                        </tr>

                                        <tr>

                                            <td style="text-align: center;">
                                                <label class="col-form-label" style="display: inline-table;  font-weight: 500 !important; font-style: normal;"> Total:</label>

                                            </td>
                                            <td>
                                                <label id="total" style="display: inline-table;  font-weight: bold !important; font-style: normal;">@decimal.Round(@Model.Liquidacion.EncCierre.Total.Value, 2)</label>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>


                    </div>


                </div>


            </div>
        </div>


    </div>
</div>

<div class="row">
    <div class="col-sm-6">
      
    </div>
    <div class="col-sm-6">
        @if(Model.Liquidacion.EncCierre.Estado == "E")
            {

                <div class="d-flex justify-content-end">

                    <button onclick="javascript: Aceptar();" class="btn btn-w-m btn-primary" id="btnAceptar" title="Aceptar">Aceptar</button> &nbsp;
                    <button onclick="javascript: Rechazar();" id="btnRechazar" class="btn btn-w-m btn-danger" title="Rechazar">Rechazar</button>
                </div>
            }
    </div>
</div>